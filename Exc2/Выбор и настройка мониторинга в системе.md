# Задание 2. Мониторинг

## Мотивация
Некоторые преимущества внедрения мониторинга приложений:
- Улучшение пользовательского опыта. Мониторинг позволяет отслеживать и анализировать, как конечные пользователи взаимодействуют с сервисами, оценивая скорость загрузки страниц, ошибки на пути пользователя, стабильность работы и общее качество опыта;
- Повышение стабильности и надёжности работы цифровых сервисов и каналов продаж. Мониторинг помогает непрерывно контролировать состояние сервисов, прогнозировать возможные сбои и отклонения в их производительности, способствуя своевременному устранению проблем и обеспечению стабильной работы;
- Ускорение инноваций и Time-to-Market. Интеграция мониторинга с DevOps и CI/CD-процессами позволяет ускорить разработку и развёртывание новых функций и продуктов;
- Оптимизация операционных затрат. Мониторинг предоставляет данные о том, как эффективно используются ИТ-ресурсы организации, что позволяет компаниям оптимизировать инфраструктуру, избегая переплат за избыточные мощности или недостаточное использование серверов;
- Аналитика для принятия стратегических решений. Благодаря глубокой аналитике, предоставляемой мониторингом, компании могут принимать более обоснованные управленческие решения, оперативно определять, где необходимо улучшение, куда следует инвестировать больше ресурсов, какие процессы нуждаются в пересмотре. 


## Выбор подхода к мониторингу
Методология RED, применима для мониторинга микросервисов, баз данных и очередей асинхронного взаимодействия. Измеряет три ключевых показателя:
- Rate — количество запросов в секунду, обслуживаемых сервисом;
- Errors — количество неудачных запросов в секунду;
- Duration — количество времени, которое занимает каждый запрос (выражается в виде временного интервала).
Эти метрики помогут понять, как пользователи взаимодействуют с системой и общий пользовательский опыт.

Для мониторинга системных ресурсов подходит методология USE. Она полезна для мониторинга системных ресурсов, таких как CPU, память и ввод-вывод. Эта методология может дополнить RED, когда нужно глубже изучить проблемы на уровне ресурсов.

## Список возможных метрик для отслеживания

| Сервисы                    | Метрика                                | Описание                                                                                                                                                                                                                                                 |
|----------------------------|----------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Messages Queue             | Number of dead-letter-exchange letters | Выявлять постоянные проблемы. Сообщения в очереди мёртвых писем указывают на уведомления, которые не удалось обработать после нескольких попыток. Мониторинг помогает определить постоянные ошибки, например, неверные адреса или сбои в работе сервера. |
| Messages Queue             | Number of message in flight            | Нужна для того, чтобы обнаруживать задержку сообщений в очереди. Если скорость обработки сообщений потребителем ниже, чем их отправка, со временем может образоваться большой задел непрочитанных сообщений.                                             |
| shop API, CRM API, MES API | Number of requests (RPS)               | Нужна для оценки производительности системы. Она указывает, сколько запросов сервер может обрабатывать в секунду.                                                                                                                                        |
| shop API, CRM API, MES API | Response time P99 latency              | Длительность исполнения запроса. Представляет собой порог производительности приложения, при котором 99% запросов выполняются за время, не превышающее порог (99-й процентиль).                                                                          |
| shop API, CRM API, MES API | Response time P95 latency              | Длительность исполнения запроса. Представляет собой порог производительности приложения, при котором 95% запросов выполняются за время, не превышающее порог (95-й процентиль).                                                                          |
| shop API, CRM API, MES API | CPU %                                  | Измеряется для оценки загруженности процессора (CPU).                                                                                                                                                                                                    |
| shop API, CRM API, MES API | Memory Utilisation                     | Измеряется для оценки потребления памяти.                                                                                                                                                                                                                |
| shop db, MES db            | Memory Utilisation for db instance     | Измеряется для контроля за использованием памяти в экземпляре базы данных. По результатам можно определить, достаточно ли памяти для выполнения запросов и создания соединений.                                                                          |
| shop db, MES db            | Number of connections for db instance  | Измеряет количество подключений к экземпляру базы данных. Внезапное увеличение количества подключений или их значение выше среднего за определённый период могут указывать на проблемы.                                                                  |
| 3d files storage           | Size of storage                        | Размер хранилища                                                                                                                                                                                                                                         |
| shop db, MES db            | Size of db instance                    | Размер базы данных                                                                                                                                                                                                                                       |
| shop API, CRM API, MES API | Number of HTTP 4xx/5xx                 | Кол-во ошибок. Измеряется для выявления ошибок в коде приложения и инфраструктуре проекта.                                                                                                                                                               |
| shop API, CRM API, MES API | Number of simultanious sessions        | Измеряется для контроля за нагрузкой на инфраструктуру. Количество одновременных вызовов или запросов к API, что позволяет избежать перегрузки серверов большим количеством одновременных запросов и обеспечить их бесперебойную и эффективную работу.   |

## План действий
- Реализовать сбор метрик в сервисах. Установка интеллектуальных агентов(специфичный для среды приложения) для каждого приложения;
- Развернуть инстанс Prometheus для получения временных рядов из экпортеров;
- Развернуть инстанс Grafana для визуализации временных рядов из Prometheus;
- Подключение приложений и тестирование инструментов мониторинга в экспериментальной среде;
- Сформировать отчёт. Настроить дашборды для сервисов;
- Тестирование инструментов мониторинга в прод среде;
- Использование системы мониторинга.
